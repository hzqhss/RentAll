{% extends 'partials/base.html' %} {% load static %} {% block content %}

<!-- Hidden input to store current user ID for JavaScript -->
<input type="hidden" id="current-user-id" value="{{ request.user.id }}">

<!-- Main Contents -->
<div class="main_content">
  <div class="mcontainer">
    <!-- Profile cover -->
    <div class="profile user-profile">
      <div class="profiles_banner">
        <img src="{{request.user.profile.cover_image.url}}" alt="" />
        <div
          class="profile_action absolute bottom-0 right-0 space-x-1.5 p-3 text-sm z-50 hidden lg:flex"
        >
          <a
            href="#offcanvas-edit-profile" uk-toggle
            class="flex items-center justify-center h-8 px-3 rounded-md bg-gray-700 bg-opacity-70 text-white space-x-1.5"
          >
            <ion-icon name="create-outline" class="text-xl"></ion-icon>
            <span> Edit </span>
          </a>
        </div>
      </div>
      <div class="profiles_content">
        <div class="profile_avatar">
          <div class="profile_avatar_holder">
            <img src="{{request.user.profile.image.url}}" alt="" />
          </div>
          <div class="user_status status_online"></div>
          <div class="icon_change_photo" hidden>
            <ion-icon name="camera" class="text-xl"></ion-icon>
          </div>
        </div>

        <div class="profile_info">
          <h1>{{request.user.profile.full_name}}</h1>
          <p class="text-center">{{request.user.profile.bio}}</p>
        </div>
      </div>

      <div class="flex justify-between lg:border-t border-gray-100 flex-col-reverse lg:flex-row pt-2">
        <nav class="responsive-nav pl-3">
          <ul uk-switcher="connect: #timeline-tab; animation: uk-animation-fade">
            <li><a href="#">Timeline</a></li>
            <li>
              <a href="#"
                >Friends <span>{{ friend_count }}</span>
              </a>
            </li>
            <li>
              <a href="#">Rental Item Listing <span>{{ products.count }}</span> </a>
            </li>
            <li><a href="#">Looking For Rent <!--<span>{{ looking_posts.count }}</span>--></a></li>
            <li><a href="#">Saved Post</a></li>
          </ul>
        </nav>

        <!-- button actions -->
        <div
          class="flex items-center space-x-1.5 flex-shrink-0 pr-4 mb-2 justify-center order-1 relative"
        >
          {% if profile.user != request.user %}
          <!-- add friend btn -->
          {% if profile.user in request.user.profile.friends.all %}
          <!--ni kalau dh jadi kwn-->
          <a
            class="unfriend-btn flex items-center justify-center h-10 px-5 rounded-md bg-red-600 text-white space-x-1.5 hover:text-white unfriend{{profile.user.id}}"
            data-unfriend="{{profile.user.id}}"
            href="#"
          >
            <span class="unfriend-text"
              ><i class="fas fa-user-minus"></i> Unfollow
            </span>
          </a>
          {% else %}
          <!--kalau tak, boleh add friend @ pending, boleh cancel -->

          {% if bool == true %}
            <!--if dah send friend request-->
            <a class="add-friend-btn flex items-center justify-center h-10 px-5 rounded-md bg-red-600 text-white space-x-1.5 hover:text-white add-friend{{profile.user.id}}" data-friend-id="{{profile.user.id}}" href="#">
                <span class="friend-text" ><i class="fas fa-user-minus"></i> Cancel Request </span>
            </a>
          {% else %}
            <a class="add-friend-btn flex items-center justify-center h-10 px-5 rounded-md bg-blue-600 text-white space-x-1.5 hover:text-white add-friend{{profile.user.id}}" data-friend-id="{{profile.user.id}}" href="#">
                <span class="friend-text" ><i class="fas fa-user-plus"></i> Follow </span>
            </a>
          {% endif %} {% endif %} {% endif %}


          <!-- more icon -->
          <a
            href="#"
            class="flex items-center justify-center h-10 w-10 rounded-md bg-gray-100"
          >
            <ion-icon name="ellipsis-horizontal" class="text-xl"></ion-icon>
          </a>
          <!-- more drowpdown -->
          <div
            class="bg-white w-56 shadow-md mx-auto p-2 mt-12 rounded-md text-gray-500 hidden border border-gray-100 dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"
            uk-drop="mode: click;pos: bottom-right;animation: uk-animation-slide-bottom-small; offset:5"
          >
            <ul class="space-y-1">
              <li>
                <a
                  href="#"
                  class="flex items-center px-3 py-2 hover:bg-gray-100 hover:text-gray-800 rounded-md dark:hover:bg-gray-800"
                >
                  <ion-icon
                    name="arrow-redo-outline"
                    class="pr-2 text-xl"
                  ></ion-icon>
                  Share Profile
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="uk-switcher lg:mt-8 mt-4" id="timeline-tab">
      <!-- Timeline -->
      <div class="md:flex md:justify-center lg:px-16">
        <div class="space-y-5 flex-shrink-0 w-full max-w-2xl mx-auto">
          <!-- Post Div -->
          <div class="post-div" data-purpose="timeline">
            {% for p in general_posts %}
            <div class="card lg:mx-0 uk-animation-slide-bottom-small mt-3 mb-3">
              <!-- post header-->
              <div class="flex justify-between items-center lg:p-4 p-2.5">
                <div class="flex flex-1 items-center space-x-4">
                  <a href="#">
                    {% if p.user.profile and p.user.profile.image %}
                    <img
                      src="{{ p.user.profile.image.url }}"
                      class="bg-gray-200 border border-white rounded-full w-10 h-10"
                    />
                    {% else %}
                    <img
                      src="{% static 'assets/images/avatars/avatar-2.jpg' %}"
                      class="bg-gray-200 border border-white rounded-full w-10 h-10"
                    />
                    {% endif %}
                  </a>
                  <div class="flex-1 font-semibold capitalize">
                    <a href="#" class="text-black dark:text-gray-100">
                      {{p.user}}
                    </a>
                    <div class="text-gray-700 flex items-center space-x-2">
                      <span><small>{{p.date|timesince}} ago</small></span>
                      <ion-icon name="story-time"></ion-icon>
                    </div>
                  </div>
                </div>
                <div>
                  <a href="#">
                    <i
                      class="icon-feather-more-horizontal text-2xl hover:bg-gray-200 rounded-full p-2 transition -mr-1 dark:hover:bg-gray-700"
                    ></i>
                  </a>
                  <div class="bg-white w-56 shadow-md mx-auto p-2 mt-12 rounded-md text-gray-500 hidden text-base border border-gray-100 dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700" uk-drop="mode: click;pos: bottom-right;animation: uk-animation-slide-bottom-small">
                    <ul class="space-y-1">                      
                      <li>
                        <a id="save-post-btn-timeline-{{p.id}}" data-post-id="{{p.id}}" class="flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md dark:hover:bg-gray-800 cursor-pointer save-post-btn">
                          <i class="uil-bookmark mr-1"></i> <span class="save-text">{% if request.user in p.saved.all %} Unsave Post {% else %} Save Post {% endif %}</span>
                        </a>
                      </li>
                      <li>
                        <hr class="-mx-2 my-2 dark:border-gray-800" />
                      </li>
                      {% if p.user == request.user %}
                      <li>
                        <a href="#" class="flex items-center px-3 py-2 text-red-500 hover:bg-red-100 hover:text-red-500 rounded-md dark:hover:bg-red-600 delete-post-btn" data-post-id="{{p.id}}">
                          <i class="uil-trash-alt mr-1"></i> Delete
                        </a>
                      </li>
                      {% endif %}
                    </ul>
                  </div>
                </div>
              </div>

              {% if p.title %}
                <div class="p-5 pt-0 border-b dark:border-gray-700">
                {{p.title}}
                </div>
              {% endif %} 
              {% if p.post_thumbnail.all %}
                <div uk-lightbox class="grid grid-cols-2 gap-2">
                    {% for img in p.post_thumbnail.all %}
                        <a href="{{ img.image.url }}">
                            <img
                                src="{{ img.image.url }}"
                                alt=""
                                class="max-h-96 w-full object-cover rounded-md"
                            />
                        </a>
                    {% endfor %}
                </div>
              {% endif %}

              <!-- Product/Item Details (for Open for Rent posts) -->
              {% if p.product %}
              <div class="p-5 pt-3 border-b dark:border-gray-700">
                <a href="{% url 'core:item-detail' p.product.slug %}" class="flex space-x-3 items-start bg-gray-50 dark:bg-gray-800 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                  <img src="{{ p.product.image.url }}" class="w-20 h-20 rounded-md object-cover" alt="{{ p.product.title }}" />
                  <div class="flex-1 space-y-1">
                    <div class="font-semibold text-gray-800 dark:text-gray-100">{{ p.product.title }}</div>
                    {% if p.product.description %}
                    <div class="text-sm text-gray-600 dark:text-gray-400">{{ p.product.description }}</div>
                    {% endif %}
                    {% if p.product.location %}
                    <div class="text-sm text-gray-600 dark:text-gray-400"><i class="uil-map-marker"></i> {{ p.product.location }}</div>
                    {% endif %}
                    <div class="text-sm font-medium text-blue-600 dark:text-blue-400">Daily rate: RM {{ p.product.daily_rate }}</div>
                  </div>
                </a>
              </div>
              {% endif %}

              <div class="p-4 space-y-3">
                <div class="flex space-x-4 lg:font-bold">
                  <a
                    style="cursor: pointer"
                    class="flex items-center space-x-2"
                  >
                    <div
                      class="p-2 rounded-full like-btn{{p.id}} {% if request.user in p.likes.all %}text-blue-500 {% else %} text-black {% endif %} "
                      id="like-btn"
                      data-like-btn="{{p.id}}"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        width="22"
                        height="22"
                        class="dark:text-gray-100"
                      >
                        <path
                          d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"
                        />
                      </svg>
                    </div>
                    <div>Like</div>
                  </a>
                  <a href="#" class="flex items-center space-x-2">
                    <div
                      class="p-2 rounded-full text-black lg:bg-gray-100 dark:bg-gray-600"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        width="22"
                        height="22"
                        class="dark:text-gray-100"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z"
                          clip-rule="evenodd"
                        />
                      </svg>
                    </div>
                    <div>
                      <span id="comment-count{{p.id}}"
                        >{{p.post_comment.count}}</span
                      >
                      Comment
                    </div>
                  </a>
                  <a
                    href="#"
                    class="flex items-center space-x-2 flex-1 justify-end"
                  >
                    <div
                      class="p-2 rounded-full text-black lg:bg-gray-100 dark:bg-gray-600"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        width="22"
                        height="22"
                        class="dark:text-gray-100"
                      >
                        <path
                          d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"
                        />
                      </svg>
                    </div>
                    <div>Share</div>
                  </a>
                </div>
                <div class="flex items-center space-x-3 pt-3">
                  {% if p.likes.all.count > 0 %}
                  <div class="flex items-center">
                    {% for i in p.likes.all|slice:"3" %} {% if forloop.first %}
                    <img
                      src="{{i.profile.image.url}}"
                      alt=""
                      class="w-6 h-6 rounded-full border-2 border-white dark:border-gray-900"
                    />
                    {% else %}
                    <img
                      src="{{i.profile.image.url}}"
                      alt=""
                      class="w-6 h-6 rounded-full border-2 border-white dark:border-gray-900 -ml-2"
                    />
                    {% endif %} {% endfor %}
                  </div>
                  <div class="dark:text-gray-100">
                    <strong
                      ><span id="like-count{{p.id}}"
                        >{{p.likes.all.count}}</span
                      ></strong
                    >
                    Like
                  </div>
                  {% else %}<!--if post no like-->
                  <div class="dark:text-gray-100">
                    <strong> <span id="like-count{{p.id}}">0</span> </strong>
                    Like
                  </div>
                  {% endif %}
                </div>

                <div
                  class="border-t py-4 space-y-4 dark:border-gray-600"
                  id="comment-div{{p.id}}"
                >
                  <!--identify actual comment-->
                  {% for c in p.post_comment|slice:"2" %}
                  <div class="flex card shadow p-2" id="comment-div{{c.id}}">
                    <div class="w-10 h-10 rounded-full relative flex-shrink-0">
                      <img
                        src="{{c.user.profile.image.url}}"
                        alt=""
                        class="absolute h-full rounded-full w-full"
                      />
                    </div>
                    <div>
                      <div
                        class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 relative lg:ml-5 ml-2 lg:mr-12 dark:bg-gray-800 dark:text-gray-100 flex items-center"
                      >
                        <p class="leading-6 flex-grow">{{c.comment}}</p>
                        <!--nak tgk if comment tu milik logged in user or not-->
                        {% if c.user == request.user %}
                        <button
                          class="ml-auto text-xs"
                          id="delete-comment"
                          data-delete-comment="{{c.id}}"
                        >
                          <i class="fas fa-trash text-red-500"> </i>
                        </button>
                        {% endif %}
                      </div>

                      <!--like comment-->
                      <div
                        class="text-sm flex items-center space-x-3 mt-2 ml-5"
                      >
                        <a
                          id="like-comment-btn"
                          data-like-comment="{{c.id}}"
                          class="like-comment{{c.id}}"
                          {%
                          if
                          request.user
                          in
                          c.likes.all
                          %}
                          style="color: red; cursor: pointer"
                          {%
                          else
                          %}
                          style="color: gray; cursor: pointer"
                          {%
                          endif
                          %}
                        >
                          <i class="fas fa-heart"></i>
                        </a>
                        <small
                          ><span id="comment-likes-count{{c.id}}"
                            >{{c.likes.all.count}}</span
                          ></small
                        >
                        <!--Add Reply Comment Element-->
                        <details>
                          <summary><div class="">Reply</div></summary>
                          <details-menu
                            role="menu"
                            class="origin-topf-right relative right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focue:outline-none"
                          >
                            <div class="pfy-1" role="none">
                              <div class="p-1 d-flex">
                                <input
                                  type="text"
                                  class="with-border"
                                  name=""
                                  placeholder="Write Reply"
                                  id="reply-input{{c.id}}"
                                />
                                <button
                                  id="reply-comment-btn"
                                  data-reply-comment-btn="{{c.id}}"
                                  type="submit"
                                  class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900 data-reply-comment-btn{{c.id}}"
                                  role="menuitem"
                                >
                                  <ion-icon name="send"></ion-icon>
                                </button>
                              </div>
                            </div>
                          </details-menu>
                        </details>
                        <span> <small> {{c.date|timesince}} </small> </span>
                      </div>
                      <!--Comment replies-->
                      <div class="reply-div{{c.id}}">
                        {% for r in c.comment_replies|slice:"1" %}
                        <div
                          class="flex mr-12 mb-2 mt-2"
                          style="margin-right: 20px"
                        >
                          <div
                            class="w-10 h-10 rounded-full relative flex-shrink-0"
                          >
                            <img
                              src="{{r.user.profile.image.url}}"
                              style="width: 40px; height: 40px"
                              alt=""
                              class="absolute h-full rounded-full w-full"
                            />
                          </div>
                          <div>
                            <div
                              class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 relative lg:ml-5 ml-2 lg:mr-12 dark:bg-gray-800 dark:text-gray-100"
                            >
                              <p class="leading-6">{{r.reply}}</p>
                              <div
                                class="absolute w-3 h-3 top-3 -left-1 bg-gray-100 transform rotate-45 dark:bg-gray-800"
                              ></div>
                            </div>
                          </div>
                        </div>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                  {% empty %}
                  <div class="flex">
                    <div>
                      <div class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 relative lg:ml-5 ml-2 lg:mr-12 dark:bg-gray-800 dark:text-gray-100">
                        <p class="leading-6">No Comments Yet</p>
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                </div>

                {% if p.post_comment.count > 0 %}
                <a
                  href="{% url 'core:post-detail' p.slug %}"
                  class="hover:text-blue-600 hover:underline"
                >
                  View All {{p.post_comment.count}} Comments</a
                >
                {% endif %}

                <div
                  class="bg-gray-100 rounded-full relative dark:bg-gray-800 border-t"
                >
                  <input
                    placeholder="Add your Comment.."
                    id="comment-input{{p.id}}"
                    data-comment-input="{{p.id}}"
                    class="bg-transparent max-h-10 shadow-none px-5"
                    comment-input{{p.id}}
                  />
                  <div
                    class="-m-0.5 absolute bottom-0 flex items-center right-3 text-xl"
                  >
                    <a
                      style="cursor: pointer"
                      id="comment-btn"
                      class="comment-btn{{p.id}}"
                      data-comment-btn="{{p.id}}"
                    >
                      <ion-icon
                        name="send-outline"
                        class="hover:bg-gray-200 p-1.5 rounded-full"
                      ></ion-icon>
                    </a>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>

        {% comment %} <!-- Sidebar -->
        <div class="w-full space-y-6">
          <div class="widget card p-5">
            <h4 class="text-lg font-semibold">About</h4>
            <ul class="text-gray-600 space-y-3 mt-3">
              <li class="flex items-center space-x-2">
                <ion-icon
                  name="home-sharp"
                  class="rounded-full bg-gray-200 text-xl p-1 mr-3"
                ></ion-icon>
                Live In <strong> Cairo , Eygept </strong>
              </li>
              <li class="flex items-center space-x-2">
                <ion-icon
                  name="globe"
                  class="rounded-full bg-gray-200 text-xl p-1 mr-3"
                ></ion-icon>
                From <strong> Aden , Yemen </strong>
              </li>
              <li class="flex items-center space-x-2">
                <ion-icon
                  name="heart-sharp"
                  class="rounded-full bg-gray-200 text-xl p-1 mr-3"
                ></ion-icon>
                From <strong> Relationship </strong>
              </li>
              <li class="flex items-center space-x-2">
                <ion-icon
                  name="logo-rss"
                  class="rounded-full bg-gray-200 text-xl p-1 mr-3"
                ></ion-icon>
                Flowwed By <strong> 3,240 People </strong>
              </li>
            </ul>
            <div class="gap-3 grid grid-cols-3 mt-4">
              <img
                src="{% static 'assets/images/avatars/avatar-lg-2.jpg' %}"
                alt=""
                class="object-cover rounded-lg col-span-full"
              />
              <img
                src="{% static 'assets/images/avatars/avatar-2.jpg' %}"
                alt=""
                class="rounded-lg"
              />
              <img
                src="{% static 'assets/images/avatars/avatar-4.jpg' %}"
                alt=""
                class="rounded-lg"
              />
              <img
                src="{% static 'assets/images/avatars/avatar-5.jpg' %}"
                alt=""
                class="rounded-lg"
              />
            </div>
            <a href="#" class="button gray mt-3 w-full"> Edit </a>
          </div>

          <div class="widget card p-5 border-t">
            <div class="flex items-center justify-between mb-4">
              <div>
                <h4 class="text-lg font-semibold">Friends</h4>
                <p class="text-sm">3,4510 Friends</p>
              </div>
              <a href="#" class="text-blue-600">See all</a>
            </div>
            <div class="grid grid-cols-3 gap-3 text-gray-600 font-semibold">
              <a href="#">
                <div
                  class="avatar relative rounded-md overflow-hidden w-full h-24 mb-2"
                >
                  <img
                    src="{% static 'assets/images/avatars/avatar-1.jpg' %}"
                    alt=""
                    class="w-full h-full object-cover absolute"
                  />
                </div>
                <div class="text-sm truncate">Dennis Han</div>
              </a>
              <a href="#">
                <div
                  class="avatar relative rounded-md overflow-hidden w-full h-24 mb-2"
                >
                  <img
                    src="{% static 'assets/images/avatars/avatar-2.jpg' %}"
                    alt=""
                    class="w-full h-full object-cover absolute"
                  />
                </div>
                <div class="text-sm truncate">Erica Jones</div>
              </a>
              <a href="#">
                <div
                  class="avatar relative rounded-md overflow-hidden w-full h-24 mb-2"
                >
                  <img
                    src="{% static 'assets/images/avatars/avatar-3.jpg' %}"
                    alt=""
                    class="w-full h-full object-cover absolute"
                  />
                </div>
                <div class="text-sm truncate">Stella Johnson</div>
              </a>
              <a href="#">
                <div
                  class="avatar relative rounded-md overflow-hidden w-full h-24 mb-2"
                >
                  <img
                    src="{% static 'assets/images/avatars/avatar-4.jpg' %}"
                    alt=""
                    class="w-full h-full object-cover absolute"
                  />
                </div>
                <div class="text-sm truncate">Alex Dolgove</div>
              </a>
              <a href="#">
                <div
                  class="avatar relative rounded-md overflow-hidden w-full h-24 mb-2"
                >
                  <img
                    src="{% static 'assets/images/avatars/avatar-5.jpg' %}"
                    alt=""
                    class="w-full h-full object-cover absolute"
                  />
                </div>
                <div class="text-sm truncate">Jonathan Ali</div>
              </a>
              <a href="#">
                <div
                  class="avatar relative rounded-md overflow-hidden w-full h-24 mb-2"
                >
                  <img
                    src="{% static 'assets/images/avatars/avatar-6.jpg' %}"
                    alt=""
                    class="w-full h-full object-cover absolute"
                  />
                </div>
                <div class="text-sm truncate">Erica Han</div>
              </a>
            </div>
            <a href="#" class="button gray mt-3 w-full"> See all </a>
          </div>

        </div> {% endcomment %}
      </div>

      <!-- Friends  -->
      <div class="card md:p-6 p-2 max-w-3xl mx-auto">
        <h2 class="text-xl font-bold">Friends</h2>

        <nav class="responsive-nav border-b">
          <ul>
            <li class="active">
              <a href="#" class="lg:px-2">
                All Friends
                <span> {{ friend_count }} </span>
              </a>
            </li>
          </ul>
        </nav>

        <div class="grid md:grid-cols-4 sm:grid-cols-3 grid-cols-2 gap-x-2 gap-y-4 mt-3">
          {% for friend_data in friends %}
          <div class="card p-2">
            <a href="{% url 'userauths:profile' friend_data.friend_obj.friend.username %}">
              <img src="{{friend_data.friend_obj.friend.profile.image.url}}" class="h-36 object-cover rounded-md shadow-sm w-full"/>
            </a>
            <div class="pt-3 px-1">
              <a href="{% url 'userauths:profile' friend_data.friend_obj.friend.username %}" class="text-base font-semibold mb-0.5">
                {{friend_data.friend_obj.friend.profile.full_name|default:friend_data.friend_obj.friend.username}}
              </a>
              <p class="font-medium text-sm">
                {{ friend_data.friend_count }} Friend{% if friend_data.friend_count != 1 %}s{% endif %}
              </p>
            </div>
          </div>
          {% empty %}
          <div class="col-span-full text-center text-gray-500 py-8">
            No friends yet
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Item listing  -->
      <div id="rental-items" class="card md:p-6 p-2 max-w-3xl mx-auto">
        <div class="flex justify-between items-center md:mb-4 mb-3">
          <h2 class="text-xl font-bold">Rental Item Listing</h2>
        </div>

        <!-- Buttons -->
        <div class="flex space-x-3 mb-5">
            <a href="#offcanvas-add-item" uk-toggle class="flex items-center justify-center px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 hover:text-white">
                <ion-icon name="add-circle-outline" class="mr-2 text-xl"></ion-icon> Add Items
            </a>
            <a href="{% url 'core:rental-progress' %}" class="flex items-center justify-center px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 hover:text-white">
                <ion-icon name="stats-chart-outline" class="mr-2 text-xl"></ion-icon> View Rental Progress
            </a>
        </div>

        <!-- Items Grid -->
        {% if products %}
        <div class="grid md:grid-cols-3 sm:grid-cols-2 grid-cols-1 gap-4 mt-6">
            {% for product in products %}
            <div class="card" id="product-card-{{ product.pid }}">
                <a href="{% url 'core:item-detail' product.slug %}">
                    <img src="{{ product.image.url }}" class="h-48 object-cover rounded-t-md shadow-sm w-full">
                </a>
                <div class="p-3">
                    <a href="{% url 'core:item-detail' product.slug %}" class="text-base font-semibold mb-1"> 
                        {{ product.title }}
                    </a>
                    <p class="font-medium text-sm text-gray-600">
                        RM {{ product.daily_rate|floatformat:2 }} / day
                    </p>
                    <a href="#offcanvas-edit-item-{{ product.pid }}" uk-toggle class="bg-blue-100 w-full flex font-semibold h-8 items-center justify-center mt-3 px-3 rounded-md text-blue-600 text-sm mb-1">
                        Edit Details
                    </a>
                </div>
            </div>

            <!-- Edit Item Offcanvas for each product -->
            <div id="offcanvas-edit-item-{{ product.pid }}" uk-offcanvas="flip: true; overlay: true">
                <div class="uk-offcanvas-bar lg:w-4/12 w-full dark:bg-gray-700 dark:text-gray-300 p-0 bg-white flex flex-col justify-center">
                    <button class="uk-offcanvas-close absolute" type="button" uk-close></button>

                    <div class="-mb-1 border-b font-semibold px-5 py-5 text-lg">
                        <h4>Edit Item Details</h4>
                    </div>

                    <form action="{% url 'core:edit-item' product.pid %}" method="POST" enctype="multipart/form-data" class="p-6 space-y-3 flex-1 overflow-y-auto">
                        {% csrf_token %}
                        <div>
                            <label class="mb-0"> Title <span class="text-red-500">*</span> </label>
                            <input type="text" name="title" class="with-border" value="{{ product.title }}" required {% if product.status == 'rented' %}disabled{% endif %}>
                        </div>
                        <div>
                            <label class="mb-0"> Description <span class="text-red-500">*</span> </label>
                            <textarea name="description" class="with-border" rows="3" required {% if product.status == 'rented' %}disabled{% endif %}>{{ product.description }}</textarea>
                        </div>
                        <div>
                            <label class="mb-0"> Daily Rate (RM) <span class="text-red-500">*</span> </label>
                            <input type="number" name="daily_rate" class="with-border" value="{{ product.daily_rate|floatformat:2 }}" step="0.01" required {% if product.status == 'rented' %}disabled{% endif %}>
                        </div>
                        <div>
                            <label class="mb-0"> Location <span class="text-red-500">*</span> </label>
                            <input type="text" name="location" class="with-border" value="{{ product.location }}" required {% if product.status == 'rented' %}disabled{% endif %}>
                        </div>
                        {% if product.status == 'rented' %}
                            <div>
                                <label class="mb-0"> Status </label>
                                <input type="text" class="with-border bg-gray-100" value="Currently Rented" disabled>
                                <small class="text-gray-500 mt-1 block">This item is currently rented and cannot be edited until the rental is completed.</small>
                            </div>
                        {% else %}
                            <div>
                                <label class="mb-0"> Status <span class="text-red-500">*</span> </label>
                                <select name="status" class="selectpicker with-border">
                                    <option value="available" {% if product.status == 'available' %}selected{% endif %}>Available</option>
                                    <option value="unavailable" {% if product.status == 'unavailable' %}selected{% endif %}>Unavailable</option>
                                </select>
                            </div>
                        {% endif %}
                        
                        <div uk-form-custom class="w-full py-3">
                            <label class="mb-2 block"> Upload New Item Image </label>
                            <div class="bg-gray-100 border-2 border-dashed flex flex-col h-32 items-center justify-center relative w-full rounded-lg dark:bg-gray-800 dark:border-gray-600 overflow-hidden">
                                <img id="edit-item-image-preview-{{ product.pid }}" src="{{ product.image.url }}" class="absolute inset-0 w-full h-full object-cover" alt="Preview">
                            </div>
                            <input type="file" name="image" onchange="loadEditItemImage(event, '{{ product.pid }}')" {% if product.status == 'rented' %}disabled{% endif %}>
                        </div>

                        <div class="p-5 grid grid-cols-2 gap-4">
                            <button type="submit" class="button w-full bg-blue-600 text-white" {% if product.status == 'rented' %}disabled{% endif %}>Save Details</button>
                            <a href="#delete-item-confirm-{{ product.pid }}" uk-toggle class="button w-full bg-red-600 text-white text-center" style="background-color: #dc2626 !important;">Delete</a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Delete Confirmation Modal for each product -->
            <div id="delete-item-confirm-{{ product.pid }}" class="uk-flex-top" uk-modal>
                <div class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical rounded-lg text-center p-5">
                    <h2 class="text-lg font-bold">Confirm Deletion</h2>
                    <p class="mt-2 text-sm">Are you sure you want to delete this item? This action cannot be undone.</p>
                    <div class="flex justify-center mt-6 space-x-4">
                        <button class="uk-modal-close button bg-gray-200 text-gray-700 cancel-delete-btn" type="button" data-pid="{{ product.pid }}">Cancel</button>
                        <button class="button bg-red-600 text-white delete-item-confirm-btn" data-pid="{{ product.pid }}" type="button" style="background-color: #dc2626 !important;">Confirm</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="flex justify-center mt-6">
            <p class="text-gray-500">There are no items added</p>
        </div>
        {% endif %}
      </div>

      <!-- Looking For Rent -->
      <div class="md:flex md:justify-center lg:px-16">
        <div class="space-y-5 flex-shrink-0 w-full max-w-2xl mx-auto">
          <!-- Post Div -->
          <div class="post-div" data-purpose="looking">
            {% if looking_posts %}
              {% for p in looking_posts %}
              <div class="card lg:mx-0 uk-animation-slide-bottom-small mt-3 mb-3" id="post-card-{{p.id}}">
                <!-- post header-->
                <div class="flex justify-between items-center lg:p-4 p-2.5">
                  <div class="flex flex-1 items-center space-x-4">
                    <a href="#">
                      {% if p.user.profile and p.user.profile.image %}
                      <img
                        src="{{ p.user.profile.image.url }}"
                        class="bg-gray-200 border border-white rounded-full w-10 h-10"
                      />
                      {% else %}
                      <img
                        src="{% static 'assets/images/avatars/avatar-2.jpg' %}"
                        class="bg-gray-200 border border-white rounded-full w-10 h-10"
                      />
                      {% endif %}
                    </a>
                  <div class="flex-1 font-semibold capitalize">
                    <a href="#" class="text-black dark:text-gray-100">
                      {{p.user}}
                    </a>
                    <div class="text-gray-700 flex items-center space-x-2">
                      <span><small>{{p.date|timesince}} ago</small></span>
                      <ion-icon name="story-time"></ion-icon>
                    </div>
                  </div>
                </div>
                <div>
                  <a href="#">
                    <i class="icon-feather-more-horizontal text-2xl hover:bg-gray-200 rounded-full p-2 transition -mr-1 dark:hover:bg-gray-700"></i>
                  </a>
                  <div class="bg-white w-56 shadow-md mx-auto p-2 mt-12 rounded-md text-gray-500 hidden text-base border border-gray-100 dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700" uk-drop="mode: click;pos: bottom-right;animation: uk-animation-slide-bottom-small">
                    <ul class="space-y-1">                    
                      <li>
                        <a id="save-post-btn-timeline-{{p.id}}" data-post-id="{{p.id}}" class="flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md dark:hover:bg-gray-800 cursor-pointer save-post-btn">
                          <i class="uil-bookmark mr-1"></i> <span class="save-text">{% if request.user in p.saved.all %} Unsave Post {% else %} Save Post {% endif %}</span>
                        </a>
                      </li>
                      <li>
                        <hr class="-mx-2 my-2 dark:border-gray-800" />
                      </li>
                      <li>
                        <a href="#" class="flex items-center px-3 py-2 text-red-500 hover:bg-red-100 hover:text-red-500 rounded-md dark:hover:bg-red-600">
                          <i class="uil-trash-alt mr-1"></i> Delete
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              {% if p.title %}
                <div class="p-5 pt-0 border-b dark:border-gray-700">
                {{p.title}}
                </div>
              {% endif %} 
              {% if p.post_thumbnail.all %}
                <div uk-lightbox class="grid grid-cols-2 gap-2">
                    {% for img in p.post_thumbnail.all %}
                        <a href="{{ img.image.url }}">
                            <img
                                src="{{ img.image.url }}"
                                alt=""
                                class="max-h-96 w-full object-cover rounded-md"
                            />
                        </a>
                    {% endfor %}
                </div>
              {% endif %}

              {% if p.product %}
              <div class="p-5 pt-3 border-b dark:border-gray-700">
                <a href="{% url 'core:item-detail' p.product.slug %}" class="flex space-x-3 items-start bg-gray-50 dark:bg-gray-800 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition block">
                  <img src="{{ p.product.image.url }}" class="w-20 h-20 rounded-md object-cover" alt="{{ p.product.title }}" />
                  <div class="flex-1 space-y-1">
                    <div class="font-semibold text-gray-800 dark:text-gray-100">{{ p.product.title }}</div>
                    {% if p.product.description %}
                    <div class="text-sm text-gray-600 dark:text-gray-400">{{ p.product.description }}</div>
                    {% endif %}
                    {% if p.product.location %}
                    <div class="text-sm text-gray-600 dark:text-gray-400"><i class="uil-map-marker"></i> {{ p.product.location }}</div>
                    {% endif %}
                    <div class="text-sm font-medium text-blue-600 dark:text-blue-400">Daily rate: RM {{ p.product.daily_rate }}</div>
                  </div>
                </a>
              </div>
                </div>
              {% endif %}

              <div class="p-4 space-y-3">
                <div class="flex space-x-4 lg:font-bold">
                  <a
                    style="cursor: pointer"
                    class="flex items-center space-x-2"
                  >
                    <div
                      class="p-2 rounded-full like-btn{{p.id}} {% if request.user in p.likes.all %}text-blue-500 {% else %} text-black {% endif %} "
                      id="like-btn"
                      data-like-btn="{{p.id}}"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        width="22"
                        height="22"
                        class="dark:text-gray-100"
                      >
                        <path
                          d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"
                        />
                      </svg>
                    </div>
                    <div>Like</div>
                  </a>
                  <a href="#" class="flex items-center space-x-2">
                    <div
                      class="p-2 rounded-full text-black lg:bg-gray-100 dark:bg-gray-600"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        width="22"
                        height="22"
                        class="dark:text-gray-100"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z"
                          clip-rule="evenodd"
                        />
                      </svg>
                    </div>
                    <div>
                      <span id="comment-count{{p.id}}"
                        >{{p.post_comment.count}}</span
                      >
                      Comment
                    </div>
                  </a>
                  <a
                    href="#"
                    class="flex items-center space-x-2 flex-1 justify-end"
                  >
                    <div
                      class="p-2 rounded-full text-black lg:bg-gray-100 dark:bg-gray-600"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        width="22"
                        height="22"
                        class="dark:text-gray-100"
                      >
                        <path
                          d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"
                        />
                      </svg>
                    </div>
                    <div>Share</div>
                  </a>
                </div>
                <div class="flex items-center space-x-3 pt-3">
                  {% if p.likes.all.count > 0 %}
                  <div class="flex items-center">
                    {% for i in p.likes.all|slice:"3" %} {% if forloop.first %}
                    <img
                      src="{{i.profile.image.url}}"
                      alt=""
                      class="w-6 h-6 rounded-full border-2 border-white dark:border-gray-900"
                    />
                    {% else %}
                    <img
                      src="{{i.profile.image.url}}"
                      alt=""
                      class="w-6 h-6 rounded-full border-2 border-white dark:border-gray-900 -ml-2"
                    />
                    {% endif %} {% endfor %}
                  </div>
                  <div class="dark:text-gray-100">
                    <strong
                      ><span id="like-count{{p.id}}"
                        >{{p.likes.all.count}}</span
                      ></strong
                    >
                    Like
                  </div>
                  {% else %}<!--if post no like-->
                  <div class="dark:text-gray-100">
                    <strong> <span id="like-count{{p.id}}">0</span> </strong>
                    Like
                  </div>
                  {% endif %}
                </div>

                <div
                  class="border-t py-4 space-y-4 dark:border-gray-600"
                  id="comment-div{{p.id}}"
                >
                  <!--identify actual comment-->
                  {% for c in p.post_comment|slice:"2" %}
                  <div class="flex card shadow p-2" id="comment-div{{c.id}}">
                    <div class="w-10 h-10 rounded-full relative flex-shrink-0">
                      <img
                        src="{{c.user.profile.image.url}}"
                        alt=""
                        class="absolute h-full rounded-full w-full"
                      />
                    </div>
                    <div>
                      <div
                        class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 relative lg:ml-5 ml-2 lg:mr-12 dark:bg-gray-800 dark:text-gray-100 flex items-center"
                      >
                        <p class="leading-6 flex-grow">{{c.comment}}</p>
                        <!--nak tgk if comment tu milik logged in user or not-->
                        {% if c.user == request.user %}
                        <button
                          class="ml-auto text-xs"
                          id="delete-comment"
                          data-delete-comment="{{c.id}}"
                        >
                          <i class="fas fa-trash text-red-500"> </i>
                        </button>
                        {% endif %}
                      </div>

                      <!--like comment-->
                      <div
                        class="text-sm flex items-center space-x-3 mt-2 ml-5"
                      >
                        <a
                          id="like-comment-btn"
                          data-like-comment="{{c.id}}"
                          class="like-comment{{c.id}}"
                          {%
                          if
                          request.user
                          in
                          c.likes.all
                          %}
                          style="color: red; cursor: pointer"
                          {%
                          else
                          %}
                          style="color: gray; cursor: pointer"
                          {%
                          endif
                          %}
                        >
                          <i class="fas fa-heart"></i>
                        </a>
                        <small
                          ><span id="comment-likes-count{{c.id}}"
                            >{{c.likes.all.count}}</span
                          ></small
                        >
                        <!--Add Reply Comment Element-->
                        <details>
                          <summary><div class="">Reply</div></summary>
                          <details-menu
                            role="menu"
                            class="origin-topf-right relative right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focue:outline-none"
                          >
                            <div class="pfy-1" role="none">
                              <div class="p-1 d-flex">
                                <input
                                  type="text"
                                  class="with-border"
                                  name=""
                                  placeholder="Write Reply"
                                  id="reply-input{{c.id}}"
                                />
                                <button
                                  id="reply-comment-btn"
                                  data-reply-comment-btn="{{c.id}}"
                                  type="submit"
                                  class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900 data-reply-comment-btn{{c.id}}"
                                  role="menuitem"
                                >
                                  <ion-icon name="send"></ion-icon>
                                </button>
                              </div>
                            </div>
                          </details-menu>
                        </details>
                        <span> <small> {{c.date|timesince}} </small> </span>
                      </div>
                      <!--Comment replies-->
                      <div class="reply-div{{c.id}}">
                        {% for r in c.comment_replies|slice:"1" %}
                        <div class="flex mr-12 mb-2 mt-2" style="margin-right: 20px">
                          <div class="w-10 h-10 rounded-full relative flex-shrink-0">
                            <img src="{{r.user.profile.image.url}}" style="width: 40px; height: 40px" alt="" class="absolute h-full rounded-full w-full" />
                          </div>
                          <div>
                            <div class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 relative lg:ml-5 ml-2 lg:mr-12 dark:bg-gray-800 dark:text-gray-100">
                              <p class="leading-6">{{r.reply}}</p>
                              <div
                                class="absolute w-3 h-3 top-3 -left-1 bg-gray-100 transform rotate-45 dark:bg-gray-800"
                              ></div>
                            </div>
                          </div>
                        </div>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                  {% empty %}
                  <div class="flex">
                    <div>
                      <div class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 relative lg:ml-5 ml-2 lg:mr-12 dark:bg-gray-800 dark:text-gray-100">
                        <p class="leading-6">No Comments Yet</p>
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                </div>

                {% if p.post_comment.count > 0 %}
                <a href="{% url 'core:post-detail' p.slug %}" class="hover:text-blue-600 hover:underline">
                  View All {{p.post_comment.count}} Comments</a>
                {% endif %}

                <div class="bg-gray-100 rounded-full relative dark:bg-gray-800 border-t">
                  <input placeholder="Add your Comment.." id="comment-input{{p.id}}" data-comment-input="{{p.id}}" class="bg-transparent max-h-10 shadow-none px-5" comment-input{{p.id}} />
                  <div class="-m-0.5 absolute bottom-0 flex items-center right-3 text-xl">
                    <a style="cursor: pointer" id="comment-btn" class="comment-btn{{p.id}}" data-comment-btn="{{p.id}}">
                      <ion-icon name="send-outline" class="hover:bg-gray-200 p-1.5 rounded-full"></ion-icon>
                    </a>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
            {% else %}
              <div class="flex justify-center mt-6">
                <p class="font-semibold">You have no looking for rent posts yet.</p>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Sidebar -->
        {% comment %} <div class="w-full space-y-6">
          <div class="widget card p-5">
            <h4 class="text-lg font-semibold">About</h4>
            <ul class="text-gray-600 space-y-3 mt-3">
              <li class="flex items-center space-x-2">
                <ion-icon
                  name="home-sharp"
                  class="rounded-full bg-gray-200 text-xl p-1 mr-3"
                ></ion-icon>
                Live In <strong> Cairo , Eygept </strong>
              </li>
              <li class="flex items-center space-x-2">
                <ion-icon
                  name="globe"
                  class="rounded-full bg-gray-200 text-xl p-1 mr-3"
                ></ion-icon>
                From <strong> Aden , Yemen </strong>
              </li>
              <li class="flex items-center space-x-2">
                <ion-icon
                  name="heart-sharp"
                  class="rounded-full bg-gray-200 text-xl p-1 mr-3"
                ></ion-icon>
                From <strong> Relationship </strong>
              </li>
              <li class="flex items-center space-x-2">
                <ion-icon
                  name="logo-rss"
                  class="rounded-full bg-gray-200 text-xl p-1 mr-3"
                ></ion-icon>
                Flowwed By <strong> 3,240 People </strong>
              </li>
            </ul>
            <div class="gap-3 grid grid-cols-3 mt-4">
              <img
                src="{% static 'assets/images/avatars/avatar-lg-2.jpg' %}"
                alt=""
                class="object-cover rounded-lg col-span-full"
              />
              <img
                src="{% static 'assets/images/avatars/avatar-2.jpg' %}"
                alt=""
                class="rounded-lg"
              />
              <img
                src="{% static 'assets/images/avatars/avatar-4.jpg' %}"
                alt=""
                class="rounded-lg"
              />
              <img
                src="{% static 'assets/images/avatars/avatar-5.jpg' %}"
                alt=""
                class="rounded-lg"
              />
            </div>
            <a href="#" class="button gray mt-3 w-full"> Edit </a>
          </div>

          <div class="widget card p-5 border-t">
            <div class="flex items-center justify-between mb-4">
              <div>
                <h4 class="text-lg font-semibold">Friends</h4>
                <p class="text-sm">3,4510 Friends</p>
              </div>
              <a href="#" class="text-blue-600">See all</a>
            </div>
            <div class="grid grid-cols-3 gap-3 text-gray-600 font-semibold">
              <a href="#">
                <div
                  class="avatar relative rounded-md overflow-hidden w-full h-24 mb-2"
                >
                  <img
                    src="{% static 'assets/images/avatars/avatar-1.jpg' %}"
                    alt=""
                    class="w-full h-full object-cover absolute"
                  />
                </div>
                <div class="text-sm truncate">Dennis Han</div>
              </a>
              <a href="#">
                <div
                  class="avatar relative rounded-md overflow-hidden w-full h-24 mb-2"
                >
                  <img
                    src="{% static 'assets/images/avatars/avatar-2.jpg' %}"
                    alt=""
                    class="w-full h-full object-cover absolute"
                  />
                </div>
                <div class="text-sm truncate">Erica Jones</div>
              </a>
              <a href="#">
                <div
                  class="avatar relative rounded-md overflow-hidden w-full h-24 mb-2"
                >
                  <img
                    src="{% static 'assets/images/avatars/avatar-3.jpg' %}"
                    alt=""
                    class="w-full h-full object-cover absolute"
                  />
                </div>
                <div class="text-sm truncate">Stella Johnson</div>
              </a>
              <a href="#">
                <div
                  class="avatar relative rounded-md overflow-hidden w-full h-24 mb-2"
                >
                  <img
                    src="{% static 'assets/images/avatars/avatar-4.jpg' %}"
                    alt=""
                    class="w-full h-full object-cover absolute"
                  />
                </div>
                <div class="text-sm truncate">Alex Dolgove</div>
              </a>
              <a href="#">
                <div
                  class="avatar relative rounded-md overflow-hidden w-full h-24 mb-2"
                >
                  <img
                    src="{% static 'assets/images/avatars/avatar-5.jpg' %}"
                    alt=""
                    class="w-full h-full object-cover absolute"
                  />
                </div>
                <div class="text-sm truncate">Jonathan Ali</div>
              </a>
              <a href="#">
                <div
                  class="avatar relative rounded-md overflow-hidden w-full h-24 mb-2"
                >
                  <img
                    src="{% static 'assets/images/avatars/avatar-6.jpg' %}"
                    alt=""
                    class="w-full h-full object-cover absolute"
                  />
                </div>
                <div class="text-sm truncate">Erica Han</div>
              </a>
            </div>
            <a href="#" class="button gray mt-3 w-full"> See all </a>
          </div>

        </div> {% endcomment %}
      </div>

      <!-- Saved Post  -->
      <div class="card md:p-6 p-2 max-w-3xl mx-auto">
        <h2 class="text-xl font-bold">Saved Posts</h2>
        <div class="saved-posts-container post-div mt-4">
          {% if saved_posts %} {% for p in saved_posts %}
          <div
            class="card lg:mx-0 uk-animation-slide-bottom-small mt-3 mb-3"
            id="post-card-{{p.id}}"
          >
            <!-- post header-->
            <div class="flex justify-between items-center lg:p-4 p-2.5">
              <div class="flex flex-1 items-center space-x-4">
                {% if p.user == request.user %}
                <a href="{% url 'userauths:my-profile' %}">
                  <img
                    src="{{ p.user.profile.image.url }}"
                    class="bg-gray-200 border border-white rounded-full w-10 h-10"
                  />
                </a>
                {% else %}
                <a href="{% url 'userauths:profile' p.user.username %}">
                  <img
                    src="{{ p.user.profile.image.url }}"
                    class="bg-gray-200 border border-white rounded-full w-10 h-10"
                  />
                </a>
                {% endif %}
                <div class="flex-1 font-semibold capitalize">
                  {% if p.user == request.user %}
                  <a
                    href="{% url 'userauths:my-profile' %}"
                    class="text-black dark:text-gray-100"
                  >
                    {{p.user.profile.full_name}}
                  </a>
                  {% else %}
                  <a
                    href="{% url 'userauths:profile' p.user.username %}"
                    class="text-black dark:text-gray-100"
                  >
                    {{p.user.profile.full_name}}
                  </a>
                  {% endif %}
                  <div class="text-gray-700 flex items-center space-x-2">
                    <span><small>{{p.date|timesince}} ago</small></span>
                    <ion-icon name="story-time"></ion-icon>
                  </div>
                </div>
              </div>
              <div>
                <a href="#">
                  <i
                    class="icon-feather-more-horizontal text-2xl hover:bg-gray-200 rounded-full p-2 transition -mr-1 dark:hover:bg-gray-700"
                  ></i>
                </a>
                <div
                  class="bg-white w-56 shadow-md mx-auto p-2 mt-12 rounded-md text-gray-500 hidden text-base border border-gray-100 dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"
                  uk-drop="mode: click;pos: bottom-right;animation: uk-animation-slide-bottom-small"
                >
                  <ul class="space-y-1">
                    <li>
                      <a
                        id="save-post-btn-saved-{{p.id}}"
                        data-post-id="{{p.id}}"
                        class="save-post-btn flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md dark:hover:bg-gray-800 cursor-pointer"
                      >
                        <i class="uil-bookmark mr-1"></i>
                        <span class="save-text"> Unsave Post </span>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <a href="{% url 'core:post-detail' p.slug %}" class="p-5 pt-0 border-b dark:border-gray-700 block">
                {{p.title}}
            </a>

            {% if p.post_thumbnail.all %}
            <div uk-lightbox>
                {% for thumb in p.post_thumbnail.all %}
              <a href="{{thumb.image.url}}">
                <img
                  src="{{thumb.image.url}}"
                  alt=""
                  class="max-h-96 w-full object-cover"
                />
              </a>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Product/Item Details (for Open for Rent posts) -->
            {% if p.product %}
            <div class="p-5 pt-3 border-b dark:border-gray-700">
              <a href="{% url 'core:item-detail' p.product.slug %}" class="flex space-x-3 items-start bg-gray-50 dark:bg-gray-800 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                <img src="{{ p.product.image.url }}" class="w-20 h-20 rounded-md object-cover" alt="{{ p.product.title }}" />
                <div class="flex-1 space-y-1">
                  <div class="font-semibold text-gray-800 dark:text-gray-100">{{ p.product.title }}</div>
                  {% if p.product.description %}
                  <div class="text-sm text-gray-600 dark:text-gray-400">{{ p.product.description }}</div>
                  {% endif %}
                  {% if p.product.location %}
                  <div class="text-sm text-gray-600 dark:text-gray-400"><i class="uil-map-marker"></i> {{ p.product.location }}</div>
                  {% endif %}
                  <div class="text-sm font-medium text-blue-600 dark:text-blue-400">Daily rate: RM {{ p.product.daily_rate }}</div>
                </div>
              </a>
            </div>
            {% endif %}
          </div>
          {% endfor %} {% else %}
          <div class="flex justify-center mt-6">
            <p class="font-semibold">You have no saved posts yet.</p>
          </div>
          {% endif %}
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Create post modal -->
<div id="create-post-modal" class="create-post is-story" uk-modal>
  <div
    class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical rounded-lg p-0 lg:w-5/12 relative shadow-2xl uk-animation-slide-bottom-small">
    <form id="post-form" method="post" enctype="multipart/form-data">
      <!--prevent cross site forgery-->
      {% csrf_token %}
      <div class="text-center py-3 border-b">
        <h3 class="text-lg font-semibold">Create Post</h3>
        <button class="uk-modal-close-default bg-gray-100 rounded-full p-2.5 right-2" type="button" uk-close uk-tooltip="title: Close ; pos: bottom ;offset:7"></button>
      </div>
      <div class="flex flex-1 flex-col p-5 space-y-3">
        <div class="flex items-center space-x-3">
          <img src="{{request.user.profile.image.url}}" class="bg-gray-200 border border-white rounded-full w-11 h-11"/>
          <select id="visibility" class="selectpicker story text-sm">
            <option value="General">General</option>
            <option value="Open for Rent">Open for Rent</option>
            <option value="Looking to Rent">Looking to Rent</option>
          </select> 
        </div>

        <div class="mt-2 pl-14 relative">
          <!-- Dropdown button -->
          <button id="select-item-listings" class="bg-gray-100 h-9 items-center justify-center rounded-md text-gray-800 px-4 font-medium flex space-x-2">
            <span>Select item listings</span>
            <svg class="w-4 h-4 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>

          <!-- Dropdown menu -->
          <div id="item-listings-dropdown" class="hidden absolute left-0 mt-1 w-64 bg-white border border-gray-200 rounded-md shadow-lg z-10">
            <ul>
              <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer">Item 1</li>
              <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer">Item 2</li>
              <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer">Item 3</li>
            </ul>
          </div>
        </div>

        <div>
          <textarea id="post-caption" class="uk-textare text-black shadow-none focus:shadow-none text-xl font-medium resize-none w-full" rows="4" placeholder="Wanna rent something {{request.user|title}}?"></textarea>
        </div>
      </div>

      <!-- post image preview -->
      <div class="flex flex-1 p-5 w-100">
        <div class="grid grid-cols-3 gap-2 mt-3" id="preview_post_thumbnail">
        </div>
      </div>

      <div class="bsolute bottom-0 p-4 space-x-4 w-full">
        <div class="flex bg-gray-50 border border-purple-100 rounded-2xl p-2 shadow-sm items-center">
          <div class="lg:block hidden ml-1">Add to your post</div>
          <div class="flex flex-1 items-center lg:justify-end justify-center space-x-2">
            <label for="post-thumbnail">
              <svg class="bg-blue-100 h-9 p-1.5 rounded-full text-blue-600 w-9 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">              
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
            </label>
            <input type="file" class="d-none" name="post-thumbnail" id="post-thumbnail" onchange="loadFile(event)" multiple/>
          </div>
        </div>
      </div>
      {% comment %} <div class="flex items-center w-full justify-between border-t p-3">
        <select id="visibility" class="selectpicker mt-2 story">
          <option value="General">General</option>
          <option value="Open for Rent">Open for Rent</option>
          <option value="Looking to Rent">Looking to Rent</option>
        </select> {% endcomment %}
      <div class="flex items-center w-full justify-end border-t p-3">
        <div class="flex space-x-2">
          <button type="submit" id="share-post" class="bg-blue-600 flex h-9 items-center justify-center rounded-md text-white px-5 font-medium">
            Post
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Add Item Offcanvas -->
<div id="offcanvas-add-item" uk-offcanvas="flip: true; overlay: true">
    <div class="uk-offcanvas-bar lg:w-4/12 w-full dark:bg-gray-700 dark:text-gray-300 p-0 bg-white flex flex-col justify-center">
        <button class="uk-offcanvas-close absolute" type="button" uk-close></button>

        <!-- header -->
        <div class="-mb-1 border-b font-semibold px-5 py-5 text-lg">
            <h4>Add Item</h4>
        </div>

        <form action="{% url 'core:add-item' %}" method="POST" enctype="multipart/form-data" class="p-6 space-y-3 flex-1 overflow-y-auto">
            {% csrf_token %}
            <div>
                <label class="mb-0"> Title <span class="text-red-500">*</span> </label>
                <input type="text" name="title" class="with-border" placeholder="Item Title" required>
            </div>
            <div>
                <label class="mb-0"> Description <span class="text-red-500">*</span> </label>
                <textarea name="description" class="with-border" rows="3" placeholder="Item Description" required></textarea>
            </div>
            <div>
                <label class="mb-0"> Daily Rate (RM) <span class="text-red-500">*</span> </label>
                <input type="number" name="daily_rate" class="with-border" placeholder="0.00" step="0.01" required>
            </div>
            <div>
                <label class="mb-0"> Location <span class="text-red-500">*</span> </label>
                <input type="text" name="location" class="with-border" placeholder="Location" required>
            </div>
            
            <div uk-form-custom class="w-full py-3">
                <label class="mb-2 block"> Upload Item Image <span class="text-red-500">*</span> </label>
                <div class="bg-gray-100 border-2 border-dashed flex flex-col h-32 items-center justify-center relative w-full rounded-lg dark:bg-gray-800 dark:border-gray-600 overflow-hidden">
                    <div id="item-image-placeholder" class="flex flex-col items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-12 text-gray-400">
                            <path d="M5.5 13a3.5 3.5 0 01-.369-6.98 4 4 0 117.753-1.977A4.5 4.5 0 1113.5 13H11V9.413l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13H5.5z" />
                            <path d="M9 13h2v5a1 1 0 11-2 0v-5z" />
                        </svg>
                    </div>
                    <img id="item-image-preview" src="#" class="absolute inset-0 w-full h-full object-cover hidden" alt="Preview">
                </div>
                <input type="file" name="image" required onchange="loadItemImage(event)">
            </div>

            <div class="p-5">
                <button type="submit" class="button w-full bg-blue-600 text-white">Add Item</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Profile Offcanvas -->
<div id="offcanvas-edit-profile" uk-offcanvas="flip: true; overlay: true">
    <div class="uk-offcanvas-bar lg:w-4/12 w-full dark:bg-gray-700 dark:text-gray-300 p-0 bg-white flex flex-col justify-center">
        <button class="uk-offcanvas-close absolute" type="button" uk-close></button>

        <div class="-mb-1 border-b font-semibold px-5 py-5 text-lg">
            <h4>Edit Profile</h4>
        </div>

        <form action="{% url 'userauths:edit-profile' %}" method="POST" enctype="multipart/form-data" class="p-6 space-y-3 flex-1 overflow-y-auto">
            {% csrf_token %}
            
            <div>
                <label class="mb-2 block"> Bio </label>
                <textarea name="bio" class="with-border" rows="3">{{ request.user.profile.bio }}</textarea>
            </div>

            <div>
                <label class="mb-2 block"> Profile Image </label>
                <div class="bg-gray-100 border-2 border-dashed flex flex-col h-32 items-center justify-center relative w-full rounded-lg dark:bg-gray-800 dark:border-gray-600 overflow-hidden">
                    <img id="edit-profile-image-preview" src="{{ request.user.profile.image.url }}" class="absolute inset-0 w-full h-full object-cover" alt="Profile Preview">
                </div>
                <input type="file" name="image" class="mt-2" onchange="loadEditProfileImage(event)">
            </div>

            <div>
                <label class="mb-2 block"> Cover Image </label>
                <div class="bg-gray-100 border-2 border-dashed flex flex-col h-32 items-center justify-center relative w-full rounded-lg dark:bg-gray-800 dark:border-gray-600 overflow-hidden">
                    <img id="edit-cover-image-preview" src="{{ request.user.profile.cover_image.url }}" class="absolute inset-0 w-full h-full object-cover" alt="Cover Preview">
                </div>
                <input type="file" name="cover_image" class="mt-2" onchange="loadEditCoverImage(event)">
            </div>

            <div class="p-5">
                <button type="submit" class="button w-full bg-blue-600 text-white">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<script>
  //bila user upload pic, ada preview gambaq kt create post
  var loadFile = function (event) {
      const files = event.target.files;
      const previewContainer = document.getElementById("preview_post_thumbnail");

      // Clear old previews
      previewContainer.innerHTML = "";

      if (!files || files.length === 0) return;

      Array.from(files).forEach((file) => {
        if (!file.type.startsWith("image/")) return;

        const img = document.createElement("img");
        img.className = "rounded-md object-cover w-full h-32";
        img.src = URL.createObjectURL(file);

        img.onload = function () {
          URL.revokeObjectURL(img.src); // free memory
        };

        previewContainer.appendChild(img);
      });
    };

        // Preview for Add Item
    var loadItemImage = function(event) {
    var output = document.getElementById('item-image-preview');
    var placeholder = document.getElementById('item-image-placeholder');
    
    if (event.target.files && event.target.files[0]) {
        output.src = URL.createObjectURL(event.target.files[0]);
        output.classList.remove('hidden');
        placeholder.classList.add('hidden');
    }
    };

    // Preview for Edit Profile
    var loadEditProfileImage = function(event) {
        var output = document.getElementById('edit-profile-image-preview');
        output.src = URL.createObjectURL(event.target.files[0]);
        output.onload = function() {
            URL.revokeObjectURL(output.src) // free memory
        }
    };
    var loadEditCoverImage = function(event) {
        var output = document.getElementById('edit-cover-image-preview');
        output.src = URL.createObjectURL(event.target.files[0]);
        output.onload = function() {
            URL.revokeObjectURL(output.src) // free memory
        }
    };

    // Preview for Edit Item
    var loadEditItemImage = function(event, pid) {
        var output = document.getElementById('edit-item-image-preview-' + pid);
        output.src = URL.createObjectURL(event.target.files[0]);
        output.onload = function() {
            URL.revokeObjectURL(output.src) // free memory
        }
    };

    // AJAX for Saving/Unsavin Post
    window.addEventListener("load", function() {
        $(document).on("click", ".save-post-btn", function () {
        let id = $(this).attr("data-post-id");
        let this_val = $(this);

        $.ajax({
            url: "{% url 'core:save_post' %}",
            data: {
                "id": id
            },
            dataType: "json",
            success: function(res){
                let save_text_span = this_val.find(".save-text");

                if(res.is_saved == true){
                    save_text_span.text(" Unsave Post ");
                    this_val.addClass("text-blue-500");
                    UIkit.notification({
                        message: 'Post Saved successfully',
                        status: 'primary',
                        pos: 'top-right',
                        timeout: 5000
                    });
                } else {
                    if (this_val.closest('.saved-posts-container').length) {
                        $("#post-card-" + id).fadeOut();
                    } else {
                        save_text_span.text(" Save Post ");
                        this_val.removeClass("text-blue-500");
                    }
                    UIkit.notification({
                        message: 'Post Unsaved successfully',
                        status: 'danger',
                        pos: 'top-right',
                        timeout: 5000
                    });
                }
            },
            error: function(err) {
                console.log(err);
                UIkit.notification({
                    message: 'An error occurred. Please try again.',
                    status: 'danger',
                    pos: 'top-right',
                    timeout: 5000
                });
            }
        })
    })

    // Handle item deletion cancellation
    $(document).on("click", ".cancel-delete-btn", function () {
        let pid = $(this).data("pid");
        // The uk-modal-close on the button will hide the confirmation modal.
        // We also need to hide the edit offcanvas.
        UIkit.offcanvas('#offcanvas-edit-item-' + pid).hide();
    });

    // Handle item deletion confirmation
    $(document).on("click", ".delete-item-confirm-btn", function () {
        let pid = $(this).attr("data-pid");
        let delete_url = `/delete-item/${pid}/`;

        $.ajax({
            url: delete_url,
            type: 'POST',
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            dataType: "json",
            success: function(res){
                if(res.status === 'success'){
                    UIkit.notification({
                        message: '<span class="text-sm">Item deleted successfully</span>',
                        status: 'success',
                        pos: 'top-right',
                        timeout: 2000
                    });
                    setTimeout(function() {
                        window.location.hash = 'rental-items';
                        location.reload();
                    }, 500);
                } else {
                    UIkit.notification({ message: res.message || 'An error occurred.', status: 'danger', pos: 'top-right', timeout: 5000 });
                }
            },
            error: function(err) {
                console.log(err);
                UIkit.notification({ message: 'A server error occurred. Please try again.', status: 'danger', pos: 'top-right', timeout: 5000 });
            }
        });
    });

    });

    // Function to switch tabs based on the URL hash
    function switchTabOnHash() {
        const hash = window.location.hash;
        if (hash) {
            let switcher = document.querySelector('ul[uk-switcher]');
            if (switcher) {
                const switcherInstance = UIkit.switcher(switcher);
                if (hash === "#saved-posts") {
                    // The switcher is 0-indexed. 'Saved Post' is the 5th item.
                    switcherInstance.show(4); 
                } else if (hash === "#rental-items") {
                    // 'Rental Item Listing' is the 3rd item.
                    switcherInstance.show(2); 
                }
            }
        }
    }

    // Switch tab on initial page load and on hash changes
    window.addEventListener("load", switchTabOnHash);
    window.addEventListener("hashchange", switchTabOnHash);

    // AJAX for Add Friend / Cancel Friend Request
    $(document).on("click", ".add-friend-btn", function (e) {
      e.preventDefault();
      e.stopPropagation();
      
      console.log("Add friend button clicked");
      
      let friend_id = $(this).attr("data-friend-id");
      let btn = $(this);
      let text_span = btn.find(".friend-text");
      
      console.log("Friend ID:", friend_id);

      $.ajax({
        url: "{% url 'core:add-friend' %}",
        dataType: "json",
        data: {
          id: friend_id,
        },
        success: function (res) {
          console.log("Response received:", res);
          
          if (res.bool === true) {
            // Friend request sent - show Cancel Request with RED background
            text_span.html('<i class="fas fa-user-minus"></i> Cancel Request');
            btn.removeClass("bg-blue-600").addClass("bg-red-600");
            UIkit.notification({
              message: "Friend Request Sent",
              status: "success",
              pos: "top-right",
              timeout: 3000,
            });
          } else if (res.bool === false) {
            // Friend request cancelled - show Add Friend with BLUE background
            text_span.html('<i class="fas fa-user-plus"></i> Add Friend');
            btn.removeClass("bg-red-600").addClass("bg-blue-600");
            UIkit.notification({
              message: "Friend Request Cancelled",
              status: "warning",
              pos: "top-right",
              timeout: 3000,
            });
          } else if (res.error) {
            console.log("Error from server:", res.error);
            UIkit.notification({
              message: res.error,
              status: "warning",
              pos: "top-right",
              timeout: 3000,
            });
          }
        },
        error: function (err) {
          console.log("AJAX Error:", err);
          console.log("Response text:", err.responseText);
          UIkit.notification({
            message: "An error occurred. Please try again.",
            status: "danger",
            pos: "top-right",
            timeout: 3000,
          });
        },
      });
      
      return false;
    });

    // AJAX for Unfriend
    $(document).on("click", ".unfriend-btn", function (e) {
      e.preventDefault();
      let friend_id = $(this).attr("data-unfriend");
      let btn = $(this);

      $.ajax({
        url: "{% url 'core:unfriend' %}",
        dataType: "json",
        data: {
          id: friend_id,
        },
        success: function (res) {
          if (res.success) {
            // Unfriended - change to Add Friend button
            btn.removeClass("unfriend-btn").addClass("add-friend-btn");
            btn.attr("data-friend-id", friend_id);
            btn.removeClass("bg-red-600").addClass("bg-blue-600");
            btn.find(".unfriend-text").removeClass("unfriend-text").addClass("friend-text").html('<i class="fas fa-user-plus"></i> Add Friend');
            
            UIkit.notification({
              message: "Unfriended Successfully",
              status: "success",
              pos: "top-right",
              timeout: 3000,
            });
          }
        },
        error: function (err) {
          console.log(err);
          UIkit.notification({
            message: "An error occurred. Please try again.",
            status: "danger",
            pos: "top-right",
            timeout: 3000,
          });
        },
      });
    });
</script>

{% endblock content %}
