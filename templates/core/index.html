{% extends 'partials/base.html' %} 
{% load static %} 

{% block content %}

<!-- Hidden input to store current user ID for JavaScript -->
<input type="hidden" id="current-user-id" value="{{ request.user.id }}">

<style>
  .dropdown:hover .dropdown-menu {
    display: block;
  }
  summary::marker {
    content: ""; /*hide the pseudo element*/
  }
</style>

<!-- Main Contents -->
<div class="main_content">
  <div class="mcontainer">
    <!--  Feeds  -->
    <div class="lg:flex lg:space-x-10">
      <div class="lg:w-3/4 lg:px-20 space-y-7">

        <!-- create post -->
        <div class="card lg:mx-0 p-4" uk-toggle="target: #create-post-modal">
          <div class="flex space-x-3">
            <img
              src="{{request.user.profile.image.url}}"
              class="w-10 h-10 rounded-full"/>
            <input
              placeholder="Wanna rent or promote something {{request.user|title}}?"
              class="bg-gray-100 hover:bg-gray-200 flex-1 h-10 px-6 rounded-full"/>
          </div>
          <div
            class="grid grid-flow-col pt-3 -mx-1 -mb-1 font-semibold text-sm">
            <div
              class="hover:bg-gray-100 flex items-center p-1.5 rounded-md cursor-pointer">
              <svg
                class="bg-blue-100 h-9 mr-2 p-1.5 rounded-full text-blue-600 w-9 -my-0.5 hidden lg:block"
                data-tippy-placement="top"
                title="Tooltip"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              Photo
            </div>
          </div>
        </div>

        <!-- Post Div -->
        <div class="post-div">
            {%for p in posts %}
                <div class="card lg:mx-0 uk-animation-slide-bottom-small mt-3 mb-3" id="post-card-{{p.id}}">
                    
                    <!-- post header-->
                    <div class="flex justify-between items-center lg:p-4 p-2.5">
                    <div class="flex flex-1 items-center space-x-4">
                        {% if p.user == request.user %}
                        <a href="{% url 'userauths:my-profile' %}">
                        {% else %}
                        <a href="{% url 'userauths:profile' p.user.username %}">
                        {% endif %}
                        {% if p.user.profile and p.user.profile.image %}
                            <img src="{{ p.user.profile.image.url }}" class="bg-gray-200 border border-white rounded-full w-10 h-10"/>
                        {% else %}
                            <img src="{% static 'assets/images/avatars/avatar-2.jpg' %}" class="bg-gray-200 border border-white rounded-full w-10 h-10"/>
                        {% endif %}
                        </a>
                        <div class="flex-1 font-semibold capitalize">
                        {% if p.user == request.user %}
                        <a href="{% url 'userauths:my-profile' %}" class="text-black dark:text-gray-100">
                            {{p.user.profile.full_name}}
                        </a>
                        {% else %}
                        <a href="{% url 'userauths:profile' p.user.username %}" class="text-black dark:text-gray-100">
                            {{p.user.profile.full_name}}
                        </a>
                        {% endif %}
                        <div class="text-gray-700 flex items-center space-x-2">
                            <span><small>{{p.date|timesince}} ago</small></span>
                            <ion-icon name="story-time"></ion-icon>
                        </div>
                        </div>
                    </div>
                    <div>
                        <a href="#">
                        <i class="icon-feather-more-horizontal text-2xl hover:bg-gray-200 rounded-full p-2 transition -mr-1 dark:hover:bg-gray-700"></i>
                        </a>
                        <div class="bg-white w-56 shadow-md mx-auto p-2 mt-12 rounded-md text-gray-500 hidden text-base border border-gray-100 dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700" uk-drop="mode: click;pos: bottom-right;animation: uk-animation-slide-bottom-small">
                          <ul class="space-y-1">                        
                              <li>
                                <a id="save-post-btn{{p.id}}" data-post-id="{{p.id}}" class="flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md dark:hover:bg-gray-800 cursor-pointer save-post-btn">
                                  <i class="uil-bookmark mr-1"></i> <span class="save-text">{% if request.user in p.saved.all %} Unsave Post {% else %} Save Post {% endif %}</span>
                                </a>
                              </li>
                              <li>
                                <hr class="-mx-2 my-2 dark:border-gray-800" />
                              </li>
                              {% if p.user == request.user %}
                              <li>
                                <a href="#" class="flex items-center px-3 py-2 text-red-500 hover:bg-red-100 hover:text-red-500 rounded-md dark:hover:bg-red-600 delete-post-btn" data-post-id="{{p.id}}">
                                  <i class="uil-trash-alt mr-1"></i> Delete
                                </a>
                              </li>
                              {% endif %}
                          </ul>
                        </div>
                    </div>
                    </div>

                    {% if p.title %}
                    <div class="p-5 pt-0 border-b dark:border-gray-700">
                    {{p.title}}
                    </div>
                    {% endif %} 
                    {% if p.post_thumbnail.all %}
                      <div uk-lightbox class="grid grid-cols-2 gap-2">
                          {% for img in p.post_thumbnail.all %}
                            <a href="{{ img.image.url }}">
                              <img src="{{ img.image.url }}" alt="" class="max-h-96 w-full object-cover rounded-md"/>
                            </a>
                          {% endfor %}
                      </div>
                    {% endif %}

                    <!-- Product/Item Details (for Open for Rent posts) -->
                    {% if p.product %}
                    <div class="p-5 pt-3 border-b dark:border-gray-700">
                      <a href="{% url 'core:item-detail' p.product.slug %}" class="flex space-x-3 items-start bg-gray-50 dark:bg-gray-800 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                        <img src="{{ p.product.image.url }}" class="w-20 h-20 rounded-md object-cover" alt="{{ p.product.title }}" />
                        <div class="flex-1 space-y-1">
                          <div class="font-semibold text-gray-800 dark:text-gray-100">{{ p.product.title }}</div>
                          {% if p.product.description %}
                          <div class="text-sm text-gray-600 dark:text-gray-400">{{ p.product.description }}</div>
                          {% endif %}
                          {% if p.product.location %}
                          <div class="text-sm text-gray-600 dark:text-gray-400"><i class="uil-map-marker"></i> {{ p.product.location }}</div>
                          {% endif %}
                          <div class="text-sm font-medium text-blue-600 dark:text-blue-400">Daily rate: RM {{ p.product.daily_rate }}</div>
                        </div>
                      </a>
                    </div>
                    {% endif %}

                    <div class="p-4 space-y-3">
                    <div class="flex space-x-4 lg:font-bold">
                        <a style="cursor: pointer" class="flex items-center space-x-2">
                        <div class="p-2 rounded-full like-btn{{p.id}} {% if request.user in p.likes.all %}text-blue-500 {% else %} text-black {% endif %} "
                            id="like-btn" data-like-btn="{{p.id}}">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="22" height="22" class="dark:text-gray-100">
                            <path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"/>
                            </svg>
                        </div>
                        <div>Like</div>
                        </a>
                        <a href="#" class="flex items-center space-x-2">
                        <div class="p-2 rounded-full text-black lg:bg-gray-100 dark:bg-gray-600">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"  width="22" height="22" class="dark:text-gray-100">                    
                            <path fill-rule="evenodd" d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z"
                                clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div>
                            <span id="comment-count{{p.id}}">{{p.post_comment.count}}</span>
                            Comment
                        </div>
                        </a>
                        <a href="#" class="flex items-center space-x-2 flex-1 justify-end">
                        <div
                            class="p-2 rounded-full text-black lg:bg-gray-100 dark:bg-gray-600">
                            <svg xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 20 20" fill="currentColor" width="22" height="22" class="dark:text-gray-100" >
                            <path
                                d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"/>
                            </svg>
                        </div>
                        <div>Share</div>
                        </a>
                    </div>
                    <div class="flex items-center space-x-3 pt-3">
                        {% if p.likes.all.count > 0 %}
                          <div class="flex items-center">
                        {% for i in p.likes.all|slice:"3" %} {% if forloop.first %}
                            <img src="{{i.profile.image.url}}" alt="" class="w-6 h-6 rounded-full border-2 border-white dark:border-gray-900" />
                        {% else %}
                            <img src="{{i.profile.image.url}}" alt="" class="w-6 h-6 rounded-full border-2 border-white dark:border-gray-900 -ml-2" />
                        {% endif %} {% endfor %}
                    </div>
                    <div class="dark:text-gray-100">
                      <strong><span id="like-count{{p.id}}">{{p.likes.all.count}}</span></strong>
                        Like
                    </div>
                        {% else %}<!--if post no like-->
                        <div class="dark:text-gray-100">
                          <strong> <span id="like-count{{p.id}}">0</span> </strong> Like
                        </div>
                        {% endif %}
                    </div>

                    <div class="border-t py-4 space-y-4 dark:border-gray-600" id="comment-div{{p.id}}" >
                        <!--identify actual comment-->
                        {% for c in p.post_comment|slice:"2" %}
                        <div class="flex card shadow p-2" id="comment-div{{c.id}}">
                            <div class="w-10 h-10 rounded-full relative flex-shrink-0">
                            <img src="{{c.user.profile.image.url}}" alt="" class="absolute h-full rounded-full w-full"/>
                            </div>
                            <div>
                            <div class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 relative lg:ml-5 ml-2 lg:mr-12 dark:bg-gray-800 dark:text-gray-100 flex items-center">
                                <p class="leading-6 flex-grow">{{c.comment}}</p>
                                <!--nak tgk if comment tu milik logged in user or not--> 
                                {% if c.user == request.user %}     
                                <button class="ml-auto text-xs" id="delete-comment" data-delete-comment="{{c.id}}"> 
                                    <i class="fas fa-trash text-red-500"> </i>
                                </button>
                                {% endif %} 
                            </div>

                            <!--like comment-->
                            <div class="text-sm flex items-center space-x-3 mt-2 ml-5">
                            <a id="like-comment-btn" data-like-comment="{{c.id}}" class="like-comment{{c.id}}" {% if request.user in c.likes.all %} style="color: red; cursor: pointer" {% else %} style="color: gray; cursor: pointer" {% endif %}> <i class="fas fa-heart"></i> </a> <small ><span id="comment-likes-count{{c.id}}" >{{c.likes.all.count}}</span ></small >
                            <!--Add Reply Comment Element-->
                            <details>
                                <summary><div class="">Reply</div></summary>
                                <details-menu
                                role="menu"
                                class="origin-topf-right relative right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focue:outline-none">
                                <div class="pfy-1" role="none">
                                    <div class="p-1 d-flex">
                                    <input type="text" class="with-border" name="" placeholder="Write Reply" id="reply-input{{c.id}}" />
                                    <button id="reply-comment-btn" data-reply-comment-btn="{{c.id}}" type="submit"
                                        class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900 data-reply-comment-btn{{c.id}}"
                                        role="menuitem" >
                                        <ion-icon name="send"></ion-icon>
                                    </button>
                                    </div>
                                </div>
                                </details-menu>
                            </details>
                            <span> <small> {{c.date|timesince}} </small> </span>
                            </div>
                            <!--Comment replies-->
                            <div class="reply-div{{c.id}}">

                              {% for r in c.comment_replies|slice:"1" %}
                                <div class="flex mr-12 mb-2 mt-2" style="margin-right: 20px">
                                    <div class="w-10 h-10 rounded-full relative flex-shrink-0">
                                      <img src="{{r.user.profile.image.url}}" style="width: 40px; height: 40px" alt="" class="absolute h-full rounded-full w-full"/>
                                    </div>
                                    <div>
                                    <div class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 relative lg:ml-5 ml-2 lg:mr-12 dark:bg-gray-800 dark:text-gray-100">
                                        <p class="leading-6">{{r.reply}}</p>
                                        <div class="absolute w-3 h-3 top-3 -left-1 bg-gray-100 transform rotate-45 dark:bg-gray-800"></div>
                                    </div>
                                    </div>
                                </div>
                              {% endfor %}
                            </div>
                        </div>
                        </div>
                        {% empty %}
                        <div class="flex">
                        <div>
                            <div
                            class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 relative lg:ml-5 ml-2 lg:mr-12 dark:bg-gray-800 dark:text-gray-100">
                            <p class="leading-6">No Comments Yet</p>
                            </div>
                        </div>
                        </div>
                        {% endfor %}
                    </div>

                    <div id="view-all-comments-{{p.id}}">
                    {% if p.post_comment.count > 0 %}
                        <a href="{% url 'core:post-detail' p.slug %}" class="hover:text-blue-600 hover:underline"> View All {{p.post_comment.count}} Comments</a>
                    {% endif %}
                    </div>

                    <div class="bg-gray-100 rounded-full relative dark:bg-gray-800 border-t">
                        <input placeholder="Add your Comment.." id="comment-input{{p.id}}" data-comment-input="{{p.id}}" class="bg-transparent max-h-10 shadow-none px-5" comment-input{{p.id}}/>
                        <div class="-m-0.5 absolute bottom-0 flex items-center right-3 text-xl">
                        <a style="cursor: pointer" id="comment-btn" class="comment-btn{{p.id}}" data-comment-btn="{{p.id}}">
                            <ion-icon name="send-outline" class="hover:bg-gray-200 p-1.5 rounded-full"></ion-icon>
                        </a>
                        </div>
                    </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <div class="flex justify-center mt-6">
          <a href="#" class="bg-white dark:bg-gray-900 font-semibold my-3 px-6 py-2 rounded-full shadow-md dark:bg-gray-800 dark:text-white">No more post</a>
        </div>
      </div>
      
      <div class="lg:w-72 w-full">
        <div class="" uk-sticky="offset:80">
          <nav class="responsive-nav border-b extanded mb-2 -mt-2">
            <ul
              uk-switcher="connect: #group-details; animation: uk-animation-fade" >
              <li class="uk-active">
                <a class="active" href="#0"> You might know </a>
              </li>
            </ul>
          </nav>

          <div class="contact-list">
            {% for u in suggested_users %}
            <a href="{% url 'userauths:profile' u.username %}">
              <div class="contact-avatar">
                <img src="{{ u.profile.image.url }}" alt="" />
              </div>
              <div class="contact-username">{{ u.profile.full_name }}</div>
            </a>
            {% endfor %}
          </div>

          <nav class="responsive-nav border-b extanded mb-2 mt-6">
            <ul uk-switcher="connect: #group-details; animation: uk-animation-fade">
              <li class="uk-active">
                <a class="active" href="#0"> You might be Interested </a>
              </li>
            </ul>
          </nav>

          <div class="contact-list">
            {% for p in suggested_products %}
            <a href="{% url 'core:item-detail' p.slug %}">
              <div class="contact-avatar">
                <img src="{{ p.image.url }}" alt="" />
              </div>
              <div class="contact-username">{{ p.title }}</div>
            </a>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- </div> -->

<!-- birthdays modal -->
<div id="birthdays" uk-modal>
  <div class="uk-modal-dialog uk-modal-body rounded-xl shadow-lg">
    <!-- close button -->
    <button class="uk-modal-close-default p-2.5 bg-gray-100 rounded-full m-3" type="button" uk-close></button>

    <div class="flex items-center space-x-3 mb-10">
      <ion-icon name="gift" class="text-yellow-500 text-xl bg-yellow-50 p-1 rounded-md"></ion-icon>
      <div class="text-xl font-semibold">Today's birthdays</div>
    </div>

    <div class="space-y-6">
      <div class="sm:space-y-8 space-y-6 pb-2">
        <div class="flex items-center sm:space-x-6 space-x-3">
          <img src="{% static 'assets/images/avatars/avatar-3.jpg' %}" alt="" class="sm:w-16 sm:h-16 w-14 h-14 rounded-full"/>
          <div class="flex-1">
            <div class="flex items-center justify-between mb-3">
              <div class="text-base font-semibold">
                <a href="#"> Alex Dolgove </a>
              </div>
              <div class="font-medium text-sm text-gray-400">19 years old</div>
            </div>
            <div class="relative">
              <input type="text" name="" id="" class="with-border" placeholder="Write her on Timeline"/>
              <ion-icon name="happy" class="absolute right-3 text-2xl top-1/4"></ion-icon>
            </div>
          </div>
        </div>
        <div class="flex items-center sm:space-x-6 space-x-3">
          <img src="{% static 'assets/images/avatars/avatar-2.jpg' %}" alt="" class="sm:w-16 sm:h-16 w-14 h-14 rounded-full"/>
          <div class="flex-1">
            <div class="flex items-center justify-between mb-3">
              <div class="text-base font-semibold">
                <a href="#"> Stella Johnson </a>
              </div>
              <div class="font-medium text-sm text-gray-400">19 years old</div>
            </div>
            <div class="relative">
              <input type="text" name="" id="" class="with-border" placeholder="Write her on Timeline"/>
              <ion-icon name="happy" class="absolute right-3 text-2xl top-1/4"></ion-icon>
            </div>
          </div>
        </div>
      </div>
      <div class="relative cursor-pointer" uk-toggle="target: #upcoming; animation: uk-animation-fade">
        <div class="bg-gray-50 rounded-lg px-5 py-4 font-semibold text-base">
          Upcoming birthdays
        </div>
        <i class="-translate-y-1/2 absolute icon-feather-chevron-up right-4 text-xl top-1/2 transform text-gray-400" id="upcoming" hidden></i>
        <i class="-translate-y-1/2 absolute icon-feather-chevron-down right-4 text-xl top-1/2 transform text-gray-400" id="upcoming"></i>
      </div>
      <div class="mt-5 sm:space-y-8 space-y-6" id="upcoming" hidden>
        <div class="flex items-center sm:space-x-6 space-x-3">
          <img src="{% static 'assets/images/avatars/avatar-6.jpg' %}" alt="" class="sm:w-16 sm:h-16 w-14 h-14 rounded-full"/>
          <div class="flex-1">
            <div class="flex items-center justify-between mb-3">
              <div class="text-base font-semibold">
                <a href="#"> Erica Jones </a>
              </div>
              <div class="font-medium text-sm text-gray-400">19 years old</div>
            </div>
            <div class="relative">
              <input type="text" name="" id="" class="with-border" placeholder="Write her on Timeline"/>
              <ion-icon name="happy" class="absolute right-3 text-2xl top-1/4"></ion-icon>
            </div>
          </div>
        </div>
        <div class="flex items-center sm:space-x-6 space-x-3">
          <img src="{% static 'assets/images/avatars/avatar-5.jpg' %}" alt="" class="sm:w-16 sm:h-16 w-14 h-14 rounded-full"/>
          <div class="flex-1">
            <div class="flex items-center justify-between mb-3">
              <div class="text-base font-semibold">
                <a href="#"> Dennis Han </a>
              </div>
              <div class="font-medium text-sm text-gray-400">19 years old</div>
            </div>
            <div class="relative">
              <input type="text" name="" id="" class="with-border" placeholder="Write her on Timeline"/>
              <ion-icon name="happy" class="absolute right-3 text-2xl top-1/4"></ion-icon>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- story-preview -->
<div class="story-prev">
  <div class="story-sidebar uk-animation-slide-left-medium">
    <div class="md:flex justify-between items-center py-2 hidden">
      <h3 class="text-2xl font-semibold">All Story</h3>
      <a href="#" class="text-blue-600"> Setting</a>
    </div>

    <div class="story-sidebar-scrollbar" data-simplebar>
      <h3 class="text-lg font-medium">Your Story</h3>

      <a class="flex space-x-4 items-center hover:bg-gray-100 md:my-2 py-2 rounded-lg hover:text-gray-700" href="#">
        <svg class="w-12 h-12 p-3 bg-gray-200 rounded-full text-blue-500 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
        </svg>
        <div class="flex-1">
          <div class="text-lg font-semibold">Create a story</div>
          <div class="text-sm -mt-0.5">Share a photo or write something.</div>
        </div>
      </a>

      <h3 class="text-lg font-medium lg:mt-3 mt-1">Friends Story</h3>

      <div class="story-users-list" uk-switcher="connect: #story_slider ; toggle: > * ; animation: uk-animation-slide-right-medium, uk-animation-slide-left-medium ">
        <a href="#">
          <div class="story-media">
            <img src="{% static 'assets/images/avatars/avatar-1.jpg' %}" alt=""/>
          </div>
          <div class="story-text">
            <div class="story-username">Dennis Han</div>
            <p>
              <span class="story-count"> 2 new </span>
              <span class="story-time"> 4Mn ago</span>
            </p>
          </div>
        </a>
        <a href="#">
          <div class="story-media">
            <img src="{% static 'assets/images/avatars/avatar-2.jpg' %}" alt=""/>
          </div>
          <div class="story-text">
            <div class="story-username">Adrian Mohani</div>
            <p>
              <span class="story-count"> 1 new </span>
              <span class="story-time"> 1hr ago</span>
            </p>
          </div>
        </a>
        <a href="#">
          <div class="story-media">
            <img src="{% static 'assets/images/avatars/avatar-3.jpg' %}" alt=""/>
          </div>
          <div class="story-text">
            <div class="story-username">Alex Dolgove</div>
            <p>
              <span class="story-count"> 3 new </span>
              <span class="story-time"> 2hr ago</span>
            </p>
          </div>
        </a>
        <a href="#">
          <div class="story-media">
            <img src="{% static 'assets/images/avatars/avatar-4.jpg' %}" alt=""/>
          </div>
          <div class="story-text">
            <div class="story-username">Stella Johnson</div>
            <p>
              <span class="story-count"> 2 new </span>
              <span class="story-time"> 3hr ago</span>
            </p>
          </div>
        </a>
        <a href="#">
          <div class="story-media">
            <img src="{% static 'assets/images/avatars/avatar-5.jpg' %}" alt=""/>
          </div>
          <div class="story-text">
            <div class="story-username">Adrian Mohani</div>
            <p>
              <span class="story-count"> 1 new </span>
              <span class="story-time"> 4hr ago</span>
            </p>
          </div>
        </a>
        <a href="#">
          <div class="story-media">
            <img src="{% static 'assets/images/avatars/avatar-8.jpg' %}" alt=""/>
          </div>
          <div class="story-text">
            <div class="story-username">Dennis Han</div>
            <p>
              <span class="story-count"> 2 new </span>
              <span class="story-time"> 8Hr ago</span>
            </p>
          </div>
        </a>
        <a href="#">
          <div class="story-media">
            <img src="{% static 'assets/images/avatars/avatar-6.jpg' %}" alt=""/>
          </div>
          <div class="story-text">
            <div class="story-username">Adrian Mohani</div>
            <p>
              <span class="story-count"> 1 new </span>
              <span class="story-time"> 12hr ago</span>
            </p>
          </div>
        </a>
        <a href="#">
          <div class="story-media">
            <img src="{% static 'assets/images/avatars/avatar-7.jpg' %}" alt=""/>
          </div>
          <div class="story-text">
            <div class="story-username">Alex Dolgove</div>
            <p>
              <span class="story-count"> 3 new </span>
              <span class="story-time"> 22hr ago</span>
            </p>
          </div>
        </a>
        <a href="#">
          <div class="story-media">
            <img src="{% static 'assets/images/avatars/avatar-8.jpg' %}" alt=""/>
          </div>
          <div class="story-text">
            <div class="story-username">Stella Johnson</div>
            <p>
              <span class="story-count"> 2 new </span>
              <span class="story-time"> 3Dy ago</span>
            </p>
          </div>
        </a>
        <a href="#">
          <div class="story-media">
            <img src="{% static 'assets/images/avatars/avatar-5.jpg' %}" alt=""/>
          </div>
          <div class="story-text">
            <div class="story-username">Adrian Mohani</div>
            <p>
              <span class="story-count"> 1 new </span>
              <span class="story-time"> 4Dy ago</span>
            </p>
          </div>
        </a>
      </div>
    </div>
  </div>
  <div class="story-content">
    <ul class="uk-switcher uk-animation-scale-up" id="story_slider">
      <li class="relative">
        <span uk-switcher-item="previous" class="slider-icon is-left"> </span>
        <span uk-switcher-item="next" class="slider-icon is-right"> </span>

        <div uk-lightbox>
          <a href="assets/images/avatars/avatar-lg-2.jpg" data-alt="Image">
            <img src="{% static 'assets/images/avatars/avatar-lg-2.jpg' %}" class="story-slider-image" data-alt="Image"/>
          </a>
        </div>
      </li>
      <li class="relative">
        <span uk-switcher-item="previous" class="slider-icon is-left"> </span>
        <span uk-switcher-item="next" class="slider-icon is-right"> </span>

        <div uk-lightbox>
          <a href="assets/images/avatars/avatar-lg-1.jpg" data-alt="Image">
            <img src="{% static 'assets/images/avatars/avatar-lg-1.jpg' %}" class="story-slider-image" data-alt="Image"/>
          </a>
        </div>
      </li>
      <li class="relative">
        <span uk-switcher-item="previous" class="slider-icon is-left"> </span>
        <span uk-switcher-item="next" class="slider-icon is-right"> </span>

        <div uk-lightbox>
          <a href="assets/images/avatars/avatar-lg-4.jpg" data-alt="Image">
            <img src="{% static 'assets/images/avatars/avatar-lg-4.jpg' %}" class="story-slider-image" data-alt="Image"/>
          </a>
        </div>
      </li>

      <li class="relative">
        <div class="bg-gray-200 story-slider-placeholder shadow-none animate-pulse"></div>
      </li>
      <li class="relative">
        <div class="bg-gray-200 story-slider-placeholder shadow-none animate-pulse"></div>
      </li>
      <li class="relative">
        <div class="bg-gray-200 story-slider-placeholder shadow-none animate-pulse"></div>
      </li>
      <li class="relative">
        <div class="bg-gray-200 story-slider-placeholder shadow-none animate-pulse"></div>
      </li>
      <li class="relative">
        <div class="bg-gray-200 story-slider-placeholder shadow-none animate-pulse"></div>
      </li>
      <li class="relative">
        <div class="bg-gray-200 story-slider-placeholder shadow-none animate-pulse"></div>
      </li>
      <li class="relative">
        <div class="bg-gray-200 story-slider-placeholder shadow-none animate-pulse"></div>
      </li>
      <li class="relative">
        <div class="bg-gray-200 story-slider-placeholder shadow-none animate-pulse"></div>
      </li>
    </ul>
  </div>

  <!-- story colose button-->
  <span class="story-btn-close" uk-toggle="target: body ; cls: story-active" uk-tooltip="title:Close story ; pos: left">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
  </span>
</div>

<!-- Create post modal -->
<div id="create-post-modal" class="create-post is-story" uk-modal>
  <div
    class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical rounded-lg p-0 lg:w-5/12 relative shadow-2xl uk-animation-slide-bottom-small">
    <form id="post-form" method="post" enctype="multipart/form-data">
      <!--prevent cross site forgery-->
      {% csrf_token %}
      <div class="text-center py-3 border-b">
        <h3 class="text-lg font-semibold">Create Post</h3>
        <button class="uk-modal-close-default bg-gray-100 rounded-full p-2.5 right-2" type="button" uk-close uk-tooltip="title: Close ; pos: bottom ;offset:7"></button>
      </div>
      <div class="flex flex-1 flex-col p-5 space-y-3">
        <div class="flex items-center space-x-3">
          <img src="{{request.user.profile.image.url}}" class="bg-gray-200 border border-white rounded-full w-11 h-11"/>
          <select id="visibility" class="selectpicker story text-sm">
            <option value="General">General</option>
            <option value="Open for Rent" {% if not user_products %}disabled{% endif %}>Open for Rent{% if not user_products %} (add item first){% endif %}</option>
            <option value="Looking to Rent">Looking to Rent</option>
          </select> 
        </div>

        <div class="mt-2 pl-14 relative">
          <!-- Dropdown button -->
          <button id="select-item-listings" class="bg-gray-100 h-9 items-center justify-center rounded-md text-gray-800 px-4 font-medium flex space-x-2 hidden">
            <span>Select item listings</span>
            <svg class="w-4 h-4 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>

          <!-- Dropdown menu -->
          <div id="item-listings-dropdown" class="hidden absolute  mt-1 w-64 bg-white border border-gray-200 rounded-md shadow-lg z-10">
            <ul>
              {% for product in user_products %}
                <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer"
                    data-value="{{ product.pid }}"
                    data-title="{{ product.title }}"
                    data-description="{{ product.description|default_if_none:'' }}"
                    data-daily-rate="{{ product.daily_rate }}"
                    data-location="{{ product.location|default_if_none:'' }}"
                    data-image="{{ product.image.url }}">
                  {{ product.title }}
                </li>
              {% empty %}
                <li class="px-4 py-2 text-gray-500 cursor-default" data-value="">No item to be selected</li>
              {% endfor %}
            </ul>
          </div>

          <!-- Selected item quick details -->
          <div id="item-listing-details" class="hidden mt-3 pr-5">
            <div class="flex space-x-3 items-start">
              <img id="item-details-image" class="w-16 h-16 rounded-md object-cover bg-gray-100" alt="Selected item image" />
              <div class="space-y-1 text-sm">
                <div class="font-semibold" id="item-details-title"></div>
                <div class="text-gray-600" id="item-details-description"></div>
                <div class="text-gray-600" id="item-details-location"></div>
                <div class="text-gray-800 font-medium" id="item-details-rate"></div>
              </div>
            </div>
          </div>
        </div>

        <div>
          <textarea id="post-caption" class="uk-textare text-black shadow-none focus:shadow-none text-xl font-medium resize-none w-full" rows="4" placeholder="Wanna rent or promote something {{request.user|title}}?"></textarea>
        </div>
      </div>

      <!-- post image preview -->
      <div class="flex flex-1 p-5 w-100">
        <div class="grid grid-cols-3 gap-2 mt-3" id="preview_post_thumbnail">
        </div>
      </div>

      <div class="bsolute bottom-0 p-4 space-x-4 w-full">
        <div class="flex bg-gray-50 border border-purple-100 rounded-2xl p-2 shadow-sm items-center">
          <div class="lg:block hidden ml-1">Add to your post</div>
          <div class="flex flex-1 items-center lg:justify-end justify-center space-x-2">
            <label for="post-thumbnail">
              <svg class="bg-blue-100 h-9 p-1.5 rounded-full text-blue-600 w-9 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">              
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
            </label>
            <input type="file" class="d-none" name="post-thumbnail" id="post-thumbnail" onchange="loadFile(event)" multiple/>
          </div>
        </div>
      </div>
      <div class="flex items-center w-full justify-end border-t p-3">
        <div class="flex space-x-2">
          <button type="submit" id="share-post" class="bg-blue-600 flex h-9 items-center justify-center rounded-md text-white px-5 font-medium">
            Post
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
    //bila user upload pic, ada preview gambaq kt create post
    var loadFile = function (event) {
      const files = event.target.files;
      const previewContainer = document.getElementById("preview_post_thumbnail");

      // Clear old previews
      previewContainer.innerHTML = "";

      if (!files || files.length === 0) return;

      Array.from(files).forEach((file) => {
        if (!file.type.startsWith("image/")) return;

        const img = document.createElement("img");
        img.className = "rounded-md object-cover w-full h-32";
        img.src = URL.createObjectURL(file);

        img.onload = function () {
          URL.revokeObjectURL(img.src); // free memory
        };

        previewContainer.appendChild(img);
      });
    };

    // AJAX for Saving Post
    window.addEventListener("load", function() {
        $(document).on("click", ".save-post-btn", function () {
        let id = $(this).attr("data-post-id");
        let this_val = $(this);
        let save_text_span = this_val.find(".save-text");
        console.log("Clicked Save Post:", id);

        $.ajax({
            url: "{% url 'core:save_post' %}",
            data: {
                "id": id
            },
            dataType: "json",
            beforeSend: function(){
                console.log("Saving...");
            },
            success: function(res){
                if(res.is_saved === true){
                    save_text_span.text(" Unsave Post");
                    this_val.addClass("text-blue-500");
                    UIkit.notification({
                        message: 'Post Saved successfully',
                        status: 'primary',
                        pos: 'top-right',
                        timeout: 5000
                    });
                } else {
                    save_text_span.text(" Save Post");
                    this_val.removeClass("text-blue-500");
                    UIkit.notification({
                        message: 'Post Unsaved successfully',
                        status: 'danger',
                        pos: 'top-right',
                        timeout: 5000
                    });
                }
            },
            error: function(err) {
                console.log(err);
                UIkit.notification({
                    message: 'An error occurred. Please try again.',
                    status: 'danger',
                    pos: 'top-right',
                    timeout: 5000
                });
            }
        })
    })
    });


</script>

{% endblock content %}
